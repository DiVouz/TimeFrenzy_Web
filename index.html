<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<title>Time Frenzy</title>
</head>

<style>
	.top-margin-50{
		margin-top: 50px;
	}
	/*
	.tester-border{
		border: solid 3px black;
	}
	*/
</style>

<body class="grey lighten-1">

	<div class="container">

		<div class="row top-margin-50">
			<!-- advertising -->
			<div class="col l2 center-align">
				<div class="card">
					<div class="card-content white-text">
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">AD</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
					</div>
				</div>
			</div>
			<!-- MAIN_GAME -->
			<div class="col l8 s12 center-align tester-border">
				<div class="row">
					<div class="col s12">
						<div>
							<h3><b>
								<span id="sec">0</span> : <span id="ms">000</span>
							</b></h3>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col s12">
						<div>
							This click: <b><span id="lap">NaN</span></b>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col s12">
						<div>
							Best click: <b><span id="best">NaN</span></b>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col s12">
						<div>
							<a class="waves-effect waves-light btn" onClick="start_watch()">Play</a>
						</div>
					</div>
				</div>
			</div>
			<!-- advertising -->
			<div class="col l2 center-align">
				<div class="card">
					<div class="card-content white-text">
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">AD</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
						<div class="black-text">|</div>
					</div>
				</div>
			</div>
		</div>

		<!-- advertising -->
		<div class="row">
			<div class="col s12 center-align">
				<div class="card">
					<div class="card-content white-text">
						<div class="black-text">- - - AD - - -</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</body>

<script>

var lastFrame = null;
var started = false;
var ms_elem;
var sec_elem;
var lap_elem;
var ms = 0;
var sec = 0;
var roundms;
var points;
var bestscore;

function start_watch(){
	if(!started){
		started = true;
		lastFrame = null;
		ms_elem = document.getElementById('ms');
		sec_elem = document.getElementById('sec');
		lap_elem = document.getElementById('lap');
		best_elem = document.getElementById('best');
		bestscore = 1000;
		window.requestAnimationFrame(step);
	}else{
		roundms = Math.round(ms);
		if(roundms <= 500){
			points = roundms;
			lap_elem.innerHTML = points;
		}else if(roundms > 500){
			points = 1000 - roundms;
			lap_elem.innerHTML = points;
		}
		if(points < bestscore) {
			bestscore = points;
			best_elem.innerHTML = bestscore;
		}
	}
}

function step(timestamp) {
	if (!lastFrame) lastFrame = timestamp;
	var this_frame = timestamp - lastFrame;
	lastFrame = timestamp;
	ms += this_frame;
	if(ms > 1000){
    		sec++;
    		ms = 0;
    	}
	if(sec >= 60) sec = 0;
  	ms_elem.innerHTML = Math.round(ms);
  	sec_elem.innerHTML = sec;
  	window.requestAnimationFrame(step);
}

</script>

</html>
